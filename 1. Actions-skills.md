$# Lab 1. Watson Assistant Actions Skills lab

Table of Contents
=================

## 1. Create WA instance

1.1. Go to cloud.ibm.com. Create a new Watson Assistant instance (Catalog - Services - AI / Machine Learning - Watson Assistant:

<img src="images/image1.png" width=500>

1.2. In the instance - select region closest to you (we will use **Frankfurt**), **Plus trial** plan, enter Service name as "**Watson Assistant - Lab**" and click "Create":

<img src="images/image2.png width=500>

## 2. Import Banking Dialog Skill

2.1. Click on Skills at the top left corner to see list of skills available

![alt_text](images/image3.png "image_tooltip")

2.2. Download banking dialog skill from https://github.ibm.com/agavrin/WatsonAssistantEN/raw/master/skills/skill-Banking-Dialog-EN.json. Click **Create Skill** button. Select **Dialog Skill**, click Next. Click **Upload Skill**. Select the downloaded file, click **Upload**.

![alt_text](images/image4.png "image_tooltip")

2.3. Go to Dialog menu, explore the choices available. Click "Try it" button, try to enter a few questions into the test widget:

*   hello, how are you? (expected response: Hello, welcome to ABC bank!)
*   I lost my card (expected response: Report missing card)

## 3. Create Banking Assistant

3.1. Click on the Assistants link at the top left corner. Click **Create Assistant**:

![alt_text](images/image5.png "image_tooltip")

3.2. Give your assistant a name of **Banking Assistant**. Click Create:

![alt_text](images/image6.png "image_tooltip")

3.3. Add your banking Dialog Skill to the assistant (Add Dialog Skill - Banking-Dialog-EN)

3.4. Click "Add an Actions skill" button. Give your new Actions skill a name **Banking Actions Skill** and click **Create actions skill**.

3.5. Your banking assistant is now ready with two Skills (Dialog skill and empty yet Actions skill). Click on the preview link and bookmark your Preview URL.

![alt_text](images/image7.png "image_tooltip")

3.6. Close your preview config page (top right X). You are now ready to create your actions.

## 4. Create Actions skill

4.1. Click on the Banking Actions Skill. Click **Create a new Action** button.

4.2. Give the action a name of "**Transfer Action**" at the top left corner.

4.3. Add a few examples to the "Training Examples" section, such as:

*   transfer money
*   I would like to transfer funds

![alt_text](images/image8.png "image_tooltip")

4.3. Create new step (**New step** button). For "Assistant says" enter the message: **Your balance: **. Keep it as is for now and create step 2.

4.4. Create step 2: **How much you would like to transfer? **Select "Number" as customer response:

![alt_text](images/image9.png "image_tooltip")

4.5. For step 3 - enter condition as below and text **You cannot transfer less than $100.**

At the end of this step select "return to previous step" (step 2).

![alt_text](images/image10.png "image_tooltip")

4.6. Create step 4. Click hamburger icon to the right of Step 4 and select Step options - set variable names. Create **balance** and **newbalance** variables.  

![alt_text](images/image11.png "image_tooltip")

Set the value of variable **newbalance** to expression of **balance** - **amount of transfer**:

![alt_text](images/image12.png "image_tooltip")

Set the text of the step 4 to the following:

![alt_text](images/image13.png "image_tooltip")

4.7. Go back to step 1 and add **balance** variable to the text as follows:

![alt_text](images/image14.png "image_tooltip")

4.8. Test your new Action skill:

*   transfer money
*   10
*   1000

Note that your balance is shown as null, as there is no integration with Dialog skill available yet. Let's integrate Actions skill with external service.

![alt_text](images/image15.png "image_tooltip")

## 5. Integrate Dialog skill with Action Skill

5.1. Now let's change our Dialog nodes to connect to Actions skill. Go into the "Dialog" section and create a new folder, called "Transfer Money" with condition of #Banking_Transfer_Money. We will use it to store a few nodes, responsible for money transfer:

![alt_text](images/image16.png "image_tooltip")

5.2. Move existing **Banking_Transfer_Money** node into that folder (by clicking the three dots menu and selecting **Move**):

![alt_text](images/image17.png "image_tooltip")

5.3. Change the **Banking_Transfer_Money** node condition to a more complex condition (we will check if balance is greater than 0):

![alt_text](images/image18.png "image_tooltip")

Change response to:
Type = Option.
Title: Your balance is &lt;? $balance ?>. Would you like to transfer?
Option 1: Yes
Option 2: No

![alt_text](images/image19.png "image_tooltip")

5.4. Add a child node to **Banking_Transfer_Money. **Give it a name of **call Transfer Action **and condition as #Bot_Control_Approve_Response. Turn disambiguation off for this node:

![alt_text](images/image20.png "image_tooltip")

Click Customize, then select "Callout to webhooks/action skill":

![alt_text](images/image21.png "image_tooltip")

Click Apply. Now you have to specify the Action Skill title in the node configuration. Also, add a balance parameter, so we pass over balance from Dialog to Action skill:

![alt_text](images/image22.png "image_tooltip")

For the Actions Skill  response we will need to store the new balance in $balance context variable and provide appropriate text to the user. Enter the following information:

![alt_text](images/image23.png "image_tooltip")

At the end you should see something similar to:

![alt_text](images/image24.png "image_tooltip")

## 6. Integrate Dialog skill with webhook

6.1. For the webhook example we will use a free service https://webhook.site/

Open https://webhook.site/ in your browser. You will be immediately given a temporary unique web service URL, such as the following:

![alt_text](images/image25.png "image_tooltip")

Click Edit button at the top right corner of the web site, and type in

{ "balance": 123000 }

as **Response body**. Set **Content type **as** application/json **and click **Save**.

![alt_text](images/image26.png "image_tooltip")

Keep this browser window open, so you can monitor requests coming to the service later on.

6.2. Open your **Banking-Dialog-EN **created at step 2.2 and go to Options/Webhooks menu. Paste your webhook URL from 5.1 into the URL field:

![alt_text](images/image27.png "image_tooltip")

6.3. Now let's add a node, which will call an external webhook and store balance retrieved from it, in a context variable. At the end it will jump to the Banking_Transfer_Money node.

Add a node below Banking_Transfer_Money:

![alt_text](images/image28.png "image_tooltip")

Let's call it **Retrieve balance** with condition = **true** and disambiguation **off**.

Click on Customize and enable **callout to webhooks...** option, then click **Call a webhook**

![alt_text](images/image29.png "image_tooltip")

At the end of the node it should Jump to Banking_Transfer_Money node and evaluate response:

![alt_text](images/image30.png "image_tooltip")

Enter the following as parameters:
Your balance retrieved: &lt;? $balance ?>

![alt_text](images/image31.png "image_tooltip")

![alt_text](images/image32.png "image_tooltip")

## 7. Test your new assistant

7.1. Go back to the Assistant assistant and click on the Preview link on the right:

![alt_text](images/image33.png "image_tooltip")

7.2. Test your new assistant:

![alt_text](images/image34.png "image_tooltip")

![alt_text](images/image35.png "image_tooltip")
